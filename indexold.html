<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ú® Cosmic Quiz ‚Äî Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, system-ui, sans-serif;
        }

        :root {
            --primary: rgba(102, 126, 234, 0.9);
            --secondary: rgba(118, 75, 162, 0.9);
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text: white;
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .dark-theme {
            --primary: rgba(102, 126, 234, 0.8);
            --secondary: rgba(118, 75, 162, 0.8);
            --glass: rgba(0, 0, 0, 0.3);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        .stars {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .screen {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 38px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 30px;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            opacity: 0.9;
            font-size: 15px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 20px 0;
        }

        .category-btn {
            padding: 28px 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 130px;
        }

        .category-btn:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .category-icon {
            font-size: 2.4em;
            margin-bottom: 12px;
        }

        /* Quiz */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .current-score {
            background: rgba(255,255,255,0.15);
            padding: 10px 16px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .timer-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 30px auto;
        }

        .timer-circle {
            transform: rotate(-90deg);
        }

        .timer-circle circle {
            stroke: rgba(255,255,255,0.2);
            stroke-width: 8;
            r: 54;
            cx: 60;
            cy: 60;
            fill: none;
        }

        .timer-progress {
            stroke: #fff;
            stroke-linecap: round;
            stroke-dasharray: 339.3;
            stroke-dashoffset: 339.3;
            transition: stroke-dashoffset 1s linear;
        }

        .timer {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.8em;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .timer.warning {
            color: #ff6b6b;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%,100% { transform: translate(-50%,-50%) scale(1); }
            50% { transform: translate(-50%,-50%) scale(1.1); }
        }

        .question-text {
            font-size: 1.5em;
            margin: 25px 0;
            text-align: center;
            line-height: 1.5;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 20px;
        }

        .answer-btn {
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 18px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            text-align: left;
            backdrop-filter: blur(10px);
        }

        .answer-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
            transform: translateX(8px);
        }

        .answer-btn.correct {
            background: rgba(46, 204, 113, 0.9);
            border-color: #2ecc71;
            animation: correctGlow 0.6s;
        }

        .answer-btn.wrong {
            background: rgba(231, 76, 60, 0.9);
            border-color: #e74c3c;
        }

        @keyframes correctGlow {
            0% { box-shadow: 0 0 10px rgba(46,204,113,0); }
            50% { box-shadow: 0 0 30px rgba(46,204,113,0.8); }
            100% { box-shadow: 0 0 10px rgba(46,204,113,0); }
        }

        /* Results */
        .final-score {
            font-size: 4em;
            font-weight: bold;
            background: linear-gradient(135deg, #fff, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .achievement {
            font-size: 5em;
            margin: 20px 0;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 18px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(0,0,0,0.25);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.15);
        }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 30px;
            animation: floatUp 2.5s ease-out forwards;
            z-index: 1000;
        }

        @keyframes floatUp {
            to {
                transform: translateY(-120vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 400px) {
            .category-grid { grid-template-columns: 1fr; }
            .timer { font-size: 2.4em; }
            .timer-container { width: 100px; height: 100px; }
            .timer-circle circle { r: 44; cx: 50; cy: 50; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">

        <!-- Main Menu -->
        <div class="screen active" id="menuScreen">
            <div class="profile-header">
                <div class="avatar"><i class="fas fa-user-astronaut"></i></div>
                <h1>Cosmic Quiz</h1>
                <p class="subtitle">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ –∑–Ω–∞–Ω–∏–µ –∏ —Ö–∞–æ—Å</p>
            </div>

            <div class="user-info" style="display:flex; align-items:center; gap:15px; padding:15px; background:rgba(255,255,255,0.1); border-radius:20px; margin-bottom:20px; backdrop-filter:blur(10px);">
                <div class="user-avatar" id="userAvatar"><i class="fas fa-user"></i></div>
                <div class="user-details">
                    <div class="user-name" id="userName">–ì–æ—Å—Ç—å</div>
                    <div class="user-id" id="userId">ID: ---</div>
                </div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon" id="themeIcon"></i></div>
            </div>

            <div class="glass-card">
                <h2 style="text-align:center; margin-bottom:20px;">üåå –í—ã–±–µ—Ä–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–µ</h2>
                <div class="category-grid">
                    <button class="category-btn" onclick="startQuiz('science')">
                        <span class="category-icon">üî¨</span> –ù–∞—É–∫–∞
                    </button>
                    <button class="category-btn" onclick="startQuiz('history')">
                        <span class="category-icon">üìú</span> –ò—Å—Ç–æ—Ä–∏—è
                    </button>
                    <button class="category-btn" onclick="startQuiz('culture')">
                        <span class="category-icon">üé®</span> –ö—É–ª—å—Ç—É—Ä–∞
                    </button>
                    <button class="category-btn" onclick="startQuiz('chaos')">
                        <span class="category-icon">üåÄ</span> –•–∞–æ—Å
                    </button>
                </div>
            </div>

            <div class="glass-card">
                <h3 style="margin-bottom:15px;"><i class="fas fa-trophy"></i> –¢–æ–ø-3</h3>
                <div id="topScores"></div>
                <button class="btn btn-secondary" onclick="showLeaderboard()">
                    <i class="fas fa-list-ol"></i> –ü–æ–ª–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div class="screen" id="quizScreen">
            <div class="progress-bar" style="height:6px; background:rgba(255,255,255,0.2); border-radius:10px; overflow:hidden; margin-bottom:20px;">
                <div class="progress-fill" id="progressBar" style="height:100%; background:linear-gradient(90deg,var(--primary),var(--secondary)); width:0%; transition:width 0.4s;"></div>
            </div>

            <div class="quiz-header">
                <div class="current-score" id="currentScore">0 / 15</div>
                <div>–í–æ–ø—Ä–æ—Å <span id="questionNumber">1</span>/15</div>
            </div>

            <div class="timer-container">
                <svg class="timer-circle" width="120" height="120">
                    <circle cx="60" cy="60" r="54" />
                    <circle class="timer-progress" cx="60" cy="60" r="54" />
                </svg>
                <div class="timer" id="timer">30</div>
            </div>

            <div class="glass-card">
                <div class="question-text" id="questionText"></div>
                <div class="answers" id="answersContainer"></div>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="screen" id="resultsScreen">
            <div class="score-display" style="text-align:center; padding:40px 20px;">
                <div class="achievement" id="achievement">üåå</div>
                <div class="final-score" id="finalScore">0/15</div>
                <p class="message" id="messageText" style="font-size:1.2em; margin:20px 0;"></p>

                <button class="btn" onclick="playAgain()"><i class="fas fa-redo"></i> –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                <button class="btn" onclick="shareResult()"><i class="fab fa-telegram"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="btn btn-secondary" onclick="showLeaderboard()"><i class="fas fa-trophy"></i> –†–µ–π—Ç–∏–Ω–≥</button>
                <button class="btn btn-secondary" onclick="backToMenu()"><i class="fas fa-home"></i> –ú–µ–Ω—é</button>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="screen" id="leaderboardScreen">
            <div style="display:flex; align-items:center; margin-bottom:20px;">
                <button class="theme-toggle" onclick="backToMenu()" style="margin-right:15px;"><i class="fas fa-arrow-left"></i></button>
                <h1 style="flex:1;">üèÜ –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥</h1>
            </div>

            <div class="glass-card">
                <div id="leaderboardContainer"></div>
                <button class="btn" onclick="backToMenu()"><i class="fas fa-rocket"></i> –í –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <audio id="soundCorrect" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
    <audio id="soundWrong" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-383.mp3"></audio>
    <audio id="soundWin" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
    <audio id="soundTick" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ (–ø–æ 15 –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
        const questions = {
            science: [
                {q: "–°–∫–æ–ª—å–∫–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–æ—Ä–∏—è —Å—Ç—Ä—É–Ω?", a: ["10", "11", "26", "4"], c: 1},
                {q: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è –∑–∞–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–∞–µ—Ç...", a: ["–ø—Ä–∏—á–∏–Ω–Ω–æ—Å—Ç—å", "–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å", "—ç–Ω–µ—Ä–≥–∏—é", "–≤—Ä–µ–º—è"], c: 1},
                {q: "–°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ –≤–∞–∫—É—É–º–µ ‚Äî —ç—Ç–æ...", a: ["–ø—Ä–∏–º–µ—Ä–Ω–æ 300 000 –∫–º/—Å", "–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ä–µ–¥—ã", "–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞", "–∏–ª–ª—é–∑–∏—è"], c: 0},
                {q: "–≠–Ω—Ç—Ä–æ–ø–∏—è –≤–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π –≤—Å–µ–≥–¥–∞...", a: ["—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è", "–æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π", "—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è", "–∫–æ–ª–µ–±–ª–µ—Ç—Å—è"], c: 2},
                {q: "–ü—Ä–∏–Ω—Ü–∏–ø –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ –ì–µ–π–∑–µ–Ω–±–µ—Ä–≥–∞ —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –Ω–µ–ª—å–∑—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ç–æ—á–Ω–æ –∑–Ω–∞—Ç—å...", a: ["–º–∞—Å—Å—É –∏ –∑–∞—Ä—è–¥", "–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –∏–º–ø—É–ª—å—Å", "—Ü–≤–µ—Ç –∏ –≤–∫—É—Å", "–≤—Ä–µ–º—è –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ"], c: 1},
                {q: "–ß—ë—Ä–Ω–∞—è –¥—ã—Ä–∞ –æ–±–ª–∞–¥–∞–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–º —Å–æ–±—ã—Ç–∏–π, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º...", a: ["–≤—Å—ë –∏—Å—á–µ–∑–∞–µ—Ç", "—Å–≤–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏", "–≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è", "–ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–Ω—Ç–∏–º–∞—Ç–µ—Ä–∏—è"], c: 1},
                {q: "–¢—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞ –∑–∞...", a: ["–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é", "—É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –í—Å–µ–ª–µ–Ω–Ω–æ–π", "—Ç—ë–º–Ω—É—é –º–∞—Ç–µ—Ä–∏—é", "–∑–≤—ë–∑–¥—ã"], c: 1},
                {q: "–°—É–ø–µ—Ä–ø–æ–∑–∏—Ü–∏—è –≤ –∫–≤–∞–Ω—Ç–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á–∞—Å—Ç–∏—Ü–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å...", a: ["–≤ –æ–¥–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏", "–≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ", "–≤–Ω–µ –≤—Ä–µ–º–µ–Ω–∏", "–≤ –¥—Ä—É–≥–æ–º –∏–∑–º–µ—Ä–µ–Ω–∏–∏"], c: 1},
                {q: "–ë–æ–ª—å—à–æ–π –≤–∑—Ä—ã–≤ ‚Äî —ç—Ç–æ...", a: ["–≤–∑—Ä—ã–≤ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ", "—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞", "–∫–æ–Ω–µ—Ü –í—Å–µ–ª–µ–Ω–Ω–æ–π", "–º–∏—Ñ"], c: 1},
                {q: "–≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –≤ –∫–≤–∞–Ω—Ç–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–µ...", a: ["–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç", "–º–µ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç", "–ª–∏—à—å –∏–∑–º–µ—Ä—è–µ—Ç", "–∏–ª–ª—é–∑–∏—è"], c: 1},
                {q: "–í—Å–µ–ª–µ–Ω–Ω–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å...", a: ["—Ç–æ–ª—å–∫–æ –ø–ª–æ—Å–∫–æ–π", "–æ—Ç–∫—Ä—ã—Ç–æ–π, –∑–∞–∫—Ä—ã—Ç–æ–π –∏–ª–∏ –ø–ª–æ—Å–∫–æ–π", "—Ç–æ–ª—å–∫–æ —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–π", "–∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π"], c: 1},
                {q: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —É–∂–µ –≤–æ–∑–º–æ–∂–Ω–∞ –¥–ª—è...", a: ["–ª—é–¥–µ–π", "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", "–º–∞—Ç–µ—Ä–∏–∏", "–≤—Ä–µ–º–µ–Ω–∏"], c: 1},
                {q: "–ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏ ‚Äî —ç—Ç–æ...", a: ["–ø–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–Ω–µ—Ä–≥–∏–∏", "–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤–∞–∫—É—É–º–∞", "—á—ë—Ä–Ω–∞—è –¥—ã—Ä–∞", "–ø–æ—Ä—Ç–∞–ª"], c: 1},
                {q: "–í—Ä–µ–º—è ‚Äî —ç—Ç–æ...", a: ["–∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞", "—á–µ—Ç–≤—ë—Ä—Ç–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ", "–∏–ª–ª—é–∑–∏—è", "–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã"], c: 3},
                {q: "–ú—ã –∂–∏–≤—ë–º –≤...", a: ["—Å–∏–º—É–ª—è—Ü–∏–∏", "—Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏", "—Å–Ω–µ", "–Ω–µ –∑–Ω–∞–µ–º"], c: 3}
            ],
            history: [
                {q: "–ü–µ—Ä–≤–∞—è –ø–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç—å –ø–æ—è–≤–∏–ª–∞—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ...", a: ["5000 –ª–µ—Ç –Ω–∞–∑–∞–¥", "10 000 –ª–µ—Ç –Ω–∞–∑–∞–¥", "3000 –ª–µ—Ç –Ω–∞–∑–∞–¥", "–≤—á–µ—Ä–∞"], c: 0},
                {q: "–í–µ–ª–∏–∫–∏–µ –ø–∏—Ä–∞–º–∏–¥—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è...", a: ["–∂–∏–ª—å—è", "–≥—Ä–æ–±–Ω–∏—Ü", "–æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–∏–π", "–≤—Å–µ–≥–æ —Å—Ä–∞–∑—É"], c: 1},
                {q: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏–π –∑–∞–≤–æ–µ–≤–∞–ª...", a: ["–≤—Å—ë", "–ø–æ—á—Ç–∏ –≤–µ—Å—å –∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–∏—Ä", "—Ç–æ–ª—å–∫–æ –ì—Ä–µ—Ü–∏—é", "–Ω–∏—á–µ–≥–æ"], c: 1},
                {q: "–ü–∞–¥–µ–Ω–∏–µ –†–∏–º—Å–∫–æ–π –∏–º–ø–µ—Ä–∏–∏ —Å–≤—è–∑–∞–Ω–æ —Å...", a: ["–æ–¥–Ω–æ–π –ø—Ä–∏—á–∏–Ω–æ–π", "–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ñ–∞–∫—Ç–æ—Ä–æ–≤", "–∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∞–º–∏", "–º–∞–≥–∏–µ–π"], c: 1},
                {q: "–≠–ø–æ—Ö–∞ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∏–ª–∞ –∏–¥–µ—é...", a: ["—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞", "—Å–≤–æ–±–æ–¥—ã", "—Ä–∞–∑—É–º–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–±—â–µ—Å—Ç–≤–∞", "–≤—Å–µ—Ö –≤—ã—à–µ"], c: 3},
                {q: "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–∞—è —Ä–µ–≤–æ–ª—é—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å –≤...", a: ["–°–®–ê", "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–∏", "–ö–∏—Ç–∞–µ", "–†–æ—Å—Å–∏–∏"], c: 1},
                {q: "–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞ –±—ã–ª–∞ –±–æ—Ä—å–±–æ–π –º–µ–∂–¥—É...", a: ["–∫–∞–ø–∏—Ç–∞–ª–∏–∑–º–æ–º –∏ –∫–æ–º–º—É–Ω–∏–∑–º–æ–º", "–í–æ—Å—Ç–æ–∫–æ–º –∏ –ó–∞–ø–∞–¥–æ–º", "–°–®–ê –∏ –†–æ—Å—Å–∏–µ–π", "–≤—Å–µ–º–∏ —Å—Ä–∞–∑—É"], c: 3},
                {q: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–∑–º–µ–Ω–∏–ª –º–∏—Ä –±–æ–ª—å—à–µ, —á–µ–º...", a: ["–ø–µ—á–∞—Ç–Ω—ã–π —Å—Ç–∞–Ω–æ–∫", "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ", "–∫–æ–ª–µ—Å–æ", "–Ω–∏—á–µ–≥–æ"], c: 0},
                {q: "–ò—Å—Ç–æ—Ä–∏—è —É—á–∏—Ç –Ω–∞—Å, —á—Ç–æ...", a: ["–≤—Å—ë –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è", "–º—ã –Ω–µ —É—á–∏–º—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö", "–±—É–¥—É—â–µ–µ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ", "–≤—Å–µ–º —Å—Ä–∞–∑—É"], c: 3},
                {q: "–†–µ–Ω–µ—Å—Å–∞–Ω—Å –Ω–∞—á–∞–ª—Å—è –≤...", a: ["–§—Ä–∞–Ω—Ü–∏–∏", "–ò—Ç–∞–ª–∏–∏", "–ì–µ—Ä–º–∞–Ω–∏–∏", "–ê–Ω–≥–ª–∏–∏"], c: 1},
                {q: "–ú–æ–Ω–≥–æ–ª—å—Å–∫–∞—è –∏–º–ø–µ—Ä–∏—è –±—ã–ª–∞ —Å–∞–º–æ–π –±–æ–ª—å—à–æ–π –ø–æ...", a: ["–Ω–∞—Å–µ–ª–µ–Ω–∏—é", "—Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏", "–±–æ–≥–∞—Ç—Å—Ç–≤—É", "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º"], c: 1},
                {q: "–ö–æ–ª—É–º–± –æ—Ç–∫—Ä—ã–ª –ê–º–µ—Ä–∏–∫—É –≤...", a: ["1492", "1512", "1429", "1692"], c: 0},
                {q: "–§–µ–æ–¥–∞–ª–∏–∑–º —Å–º–µ–Ω–∏–ª—Å—è...", a: ["–∫–∞–ø–∏—Ç–∞–ª–∏–∑–º–æ–º", "—Å–æ—Ü–∏–∞–ª–∏–∑–º–æ–º", "–∞–±—Å–æ–ª—é—Ç–∏–∑–º–æ–º", "–¥–µ–º–æ–∫—Ä–∞—Ç–∏–µ–π"], c: 0},
                {q: "–î—Ä–µ–≤–Ω–∏–π –ï–≥–∏–ø–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –æ–∫–æ–ª–æ...", a: ["1000 –ª–µ—Ç", "3000 –ª–µ—Ç", "5000 –ª–µ—Ç", "–≤–µ—á–Ω–æ"], c: 1},
                {q: "–ë—É–¥—É—â–µ–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è...", a: ["—Å–µ–π—á–∞—Å", "–≤—á–µ—Ä–∞", "–∑–∞–≤—Ç—Ä–∞", "–Ω–∏–∫–æ–≥–¥–∞"], c: 0}
            ],
            culture: [
                {q: "–ú–æ–Ω–∞ –õ–∏–∑–∞ –±—ã–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞...", a: ["–í–∞–Ω –ì–æ–≥–æ–º", "–ü–∏–∫–∞—Å—Å–æ", "–î–∞ –í–∏–Ω—á–∏", "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ"], c: 2},
                {q: "–î–∂–∞–∑ —Ä–æ–¥–∏–ª—Å—è –≤...", a: ["–ï–≤—Ä–æ–ø–µ", "–ê—Ñ—Ä–∏–∫–µ", "–°–®–ê", "–ë—Ä–∞–∑–∏–ª–∏–∏"], c: 2},
                {q: "–®–µ–∫—Å–ø–∏—Ä –Ω–∞–ø–∏—Å–∞–ª –æ–∫–æ–ª–æ...", a: ["10 –ø—å–µ—Å", "37 –ø—å–µ—Å", "100 –ø—å–µ—Å", "1000 —Å–æ–Ω–µ—Ç–æ–≤"], c: 1},
                {q: "–°–∏–º–≤–æ–ª–∏–∑–º –≤ –∏—Å–∫—É—Å—Å—Ç–≤–µ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç...", a: ["—Ä–µ–∞–ª–∏–∑–º", "—ç–º–æ—Ü–∏–∏ –∏ –∏–¥–µ–∏", "—Ü–≤–µ—Ç", "—Ñ–æ—Ä–º—É"], c: 1},
                {q: "–ë–æ–ª–ª–∏–≤—É–¥ ‚Äî —ç—Ç–æ –∫–∏–Ω–æ–∏–Ω–¥—É—Å—Ç—Ä–∏—è...", a: ["–ë—Ä–∞–∑–∏–ª–∏–∏", "–ò–Ω–¥–∏–∏", "–°–®–ê", "–ö–æ—Ä–µ–∏"], c: 1},
                {q: "–•–∞–π–∫—É ‚Äî —ç—Ç–æ –ø–æ—ç–∑–∏—è –∏–∑...", a: ["–ö–∏—Ç–∞—è", "–Ø–ø–æ–Ω–∏–∏", "–ö–æ—Ä–µ–∏", "–í—å–µ—Ç–Ω–∞–º–∞"], c: 1},
                {q: "–û–ø–µ—Ä–∞ –∫–∞–∫ –∂–∞–Ω—Ä –∑–∞—Ä–æ–¥–∏–ª–∞—Å—å –≤...", a: ["–ì–µ—Ä–º–∞–Ω–∏–∏", "–ò—Ç–∞–ª–∏–∏", "–§—Ä–∞–Ω—Ü–∏–∏", "–ê–≤—Å—Ç—Ä–∏–∏"], c: 1},
                {q: "–¢–∞–Ω–µ—Ü —Ñ–ª–∞–º–µ–Ω–∫–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑...", a: ["–ò—Å–ø–∞–Ω–∏–∏", "–ú–µ–∫—Å–∏–∫–∏", "–ê—Ä–≥–µ–Ω—Ç–∏–Ω—ã", "–ë—Ä–∞–∑–∏–ª–∏–∏"], c: 0},
                {q: "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–∏–∫–∏ –∏–∑–≤–µ—Å—Ç–Ω–∞...", a: ["–∞—Ä–∫–∞–º–∏ –∏ –∫—É–ø–æ–ª–∞–º–∏", "–≤—ã—Å–æ–∫–∏–º–∏ —Å–æ–±–æ—Ä–∞–º–∏ –∏ –≤–∏—Ç—Ä–∞–∂–∞–º–∏", "–∫–æ–ª–æ–Ω–Ω–∞–º–∏", "–º–∏–Ω–∏–º–∞–ª–∏–∑–º–æ–º"], c: 1},
                {q: "–ê–Ω–∏–º–µ ‚Äî —ç—Ç–æ –∞–Ω–∏–º–∞—Ü–∏—è –∏–∑...", a: ["–ö–∏—Ç–∞—è", "–ö–æ—Ä–µ–∏", "–Ø–ø–æ–Ω–∏–∏", "–°–®–ê"], c: 2},
                {q: "–ö—É–ª–∏–Ω–∞—Ä–∏—è –º–æ–ª–µ–∫—É–ª—è—Ä–Ω–∞—è ‚Äî —ç—Ç–æ...", a: ["—Ç—Ä–∞–¥–∏—Ü–∏–∏", "–Ω–∞—É–∫–∞ –≤ –µ–¥–µ", "–±—ã—Å—Ç—Ä–∞—è –µ–¥–∞", "–≤–µ–≥–∞–Ω—Å—Ç–≤–æ"], c: 1},
                {q: "–ú–∏—Ñ—ã –Ω—É–∂–Ω—ã –¥–ª—è...", a: ["—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", "–æ–±—ä—è—Å–Ω–µ–Ω–∏—è –º–∏—Ä–∞", "–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –ª—é–¥–µ–π", "–≤—Å–µ–≥–æ"], c: 3},
                {q: "–ú–æ–¥–∞ ‚Äî —ç—Ç–æ –∑–µ—Ä–∫–∞–ª–æ...", a: ["–≤–∫—É—Å–∞", "—ç–ø–æ—Ö–∏", "–ª–∏—á–Ω–æ—Å—Ç–∏", "–≤—Å–µ–≥–æ"], c: 3},
                {q: "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∞ –ª—é–±–∏—Ç...", a: ["–ª–∏–Ω–µ–π–Ω—ã–π —Å—é–∂–µ—Ç", "–∏–≥—Ä—ã —Å —Ñ–æ—Ä–º–æ–π", "—Ä–µ–∞–ª–∏–∑–º", "—Ä–æ–º–∞–Ω—Ç–∏–∫—É"], c: 1},
                {q: "–ö—É–ª—å—Ç—É—Ä–∞ ‚Äî —ç—Ç–æ –∂–∏–≤–æ–π...", a: ["–º—É–∑–µ–π", "–¥–∏–∞–ª–æ–≥", "—Ç—Ä–∞–¥–∏—Ü–∏—è", "–ø–æ—Ç–æ–∫"], c: 3}
            ],
            chaos: [
                {q: "2 + 2 = ?", a: ["4", "5", "—Ä—ã–±–∞", "–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã —Å—á–∏—Å–ª–µ–Ω–∏—è"], c: 3},
                {q: "–ß—Ç–æ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ: –∫—É—Ä–∏—Ü–∞ –∏–ª–∏ —è–π—Ü–æ?", a: ["–ö—É—Ä–∏—Ü–∞", "–Ø–π—Ü–æ", "–î–∏–Ω–æ–∑–∞–≤—Ä", "–ü–∞—Ä–∞–¥–æ–∫—Å"], c: 3},
                {q: "–°–º—ã—Å–ª –∂–∏–∑–Ω–∏ –ø–æ –î—É–≥–ª–∞—Å—É –ê–¥–∞–º—Å—É...", a: ["–õ—é–±–æ–≤—å", "42", "–°—á–∞—Å—Ç—å–µ", "–ù–µ –∏—Å–∫–∞—Ç—å"], c: 1},
                {q: "–†–µ–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ...", a: ["–û–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –¥–∞–Ω–Ω–æ—Å—Ç—å", "–°—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã–π –æ–ø—ã—Ç", "–°–∏–º—É–ª—è—Ü–∏—è", "–í—Å—ë –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ"], c: 3},
                {q: "–ö–æ—Ç –®—Ä—ë–¥–∏–Ω–≥–µ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ...", a: ["–∂–∏–≤ –∏ –º—ë—Ä—Ç–≤", "—Å–ø–∏—Ç", "–≥—É–ª—è–µ—Ç", "–Ω–∞–±–ª—é–¥–∞–µ—Ç –∑–∞ —Ç–æ–±–æ–π"], c: 0},
                {q: "–•–∞–æ—Å ‚Äî —ç—Ç–æ...", a: ["–ë–µ—Å–ø–æ—Ä—è–¥–æ–∫", "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—è–¥–∫–∞", "–ò—Å—Ç–æ—á–Ω–∏–∫ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞", "–ü–æ—Ä—è–¥–æ–∫ –≤—ã—Å—à–µ–≥–æ —É—Ä–æ–≤–Ω—è"], c: 3},
                {q: "–≠—Ñ—Ñ–µ–∫—Ç –±–∞–±–æ—á–∫–∏ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ...", a: ["–≤–∑–º–∞—Ö –∫—Ä—ã–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç —É—Ä–∞–≥–∞–Ω", "–º–∞–ª–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí –±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç", "–±–∞–±–æ—á–∫–∏ –æ–ø–∞—Å–Ω—ã", "–ø–æ–≥–æ–¥–∞ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞"], c: 1},
                {q: "–Ø –º—ã—Å–ª—é, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ...", a: ["—Å—É—â–µ—Å—Ç–≤—É—é", "—Å–æ–º–Ω–µ–≤–∞—é—Å—å", "–æ—à–∏–±–∞—é—Å—å", "–≤—Å—ë –≤–æ–∑–º–æ–∂–Ω–æ"], c: 3},
                {q: "–§—Ä–∞–∫—Ç–∞–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç...", a: ["–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —É–∑–æ—Ä–∞ –Ω–∞ –≤—Å–µ—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö", "–∫—Ä–∞—Å–æ—Ç—É –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å –≤ –∫–æ–Ω–µ—á–Ω–æ–º", "–≤—Å—ë –≤—ã—à–µ"], c: 3},
                {q: "–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å...", a: ["–∏–º–µ–µ—Ç –æ—Ç–≤–µ—Ç", "—Å–∞–º —Å–µ–±–µ –æ—Ç–≤–µ—Ç", "–±–µ—Å—Å–º—ã—Å–ª–µ–Ω", "—Ç—ã —É–∂–µ –∑–Ω–∞–µ—à—å"], c: 3},
                {q: "–í—Å—ë —Ç–µ—á—ë—Ç, –≤—Å—ë –∏–∑–º–µ–Ω—è–µ—Ç—Å—è ‚Äî —Å–∫–∞–∑–∞–ª...", a: ["–ü–ª–∞—Ç–æ–Ω", "–ì–µ—Ä–∞–∫–ª–∏—Ç", "–°–æ–∫—Ä–∞—Ç", "–ù–∏—Ü—à–µ"], c: 1},
                {q: "–ü–∞—Ä–∞–¥–æ–∫—Å –ª–∂–µ—Ü–∞: ¬´–≠—Ç–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ª–æ–∂–Ω–æ¬ª ‚Äî —ç—Ç–æ...", a: ["–ø—Ä–∞–≤–¥–∞", "–ª–æ–∂—å", "–∏ —Ç–æ, –∏ –¥—Ä—É–≥–æ–µ", "–Ω–∏ —Ç–æ, –Ω–∏ –¥—Ä—É–≥–æ–µ"], c: 2},
                {q: "–í—Å–µ–ª–µ–Ω–Ω–∞—è —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è...", a: ["–≤ –Ω–µ—á—Ç–æ", "–∏–∑ –Ω–∏—á–µ–≥–æ", "—Å–∞–º–∞ –≤ —Å–µ–±—è", "–≤ –º–µ—á—Ç—ã"], c: 2},
                {q: "–¢—ã —á–∏—Ç–∞–µ—à—å —ç—Ç–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ...", a: ["–¥–æ–ª–∂–µ–Ω", "—Ö–æ—á–µ—à—å", "—Å–ª—É—á–∞–π–Ω–æ", "–≤—Å—ë –ø—Ä–µ–¥—Ä–µ—à–µ–Ω–æ"], c: 3},
                {q: "–û—Ç–≤–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∂–∏–∑–Ω–∏, –≤—Å–µ–ª–µ–Ω–Ω–æ–π –∏ –≤—Å–µ–≥–æ —Ç–∞–∫–æ–≥–æ...", a: ["–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω", "42", "–ª—é–±–æ–≤—å", "—Ç—ã —Å–∞–º"], c: 3}
            ]
        };

        let currentQuiz = [], currentQuestion = 0, score = 0, timeLeft = 30, timerInterval;
        let leaderboardData = JSON.parse(localStorage.getItem('cosmic_leaderboard') || '[]');
        let currentCategory = '';
        let userId = 'guest';

        const sounds = {
            correct: document.getElementById('soundCorrect'),
            wrong: document.getElementById('soundWrong'),
            win: document.getElementById('soundWin'),
            tick: document.getElementById('soundTick')
        };

        function createStars() {
            const starsDiv = document.getElementById('stars');
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 4 + 's';
                starsDiv.appendChild(star);
            }
        }

        function initTelegramUser() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                document.getElementById('userName').textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim() || '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Å—Ç—Ä–∞–Ω–Ω–∏–∫';
                document.getElementById('userId').textContent = `ID: ${user.id}`;
                document.getElementById('userAvatar').innerHTML = '<i class="fas fa-user-astronaut"></i>';
                userId = user.id;
            }

            if (tg.colorScheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startQuiz(category) {
            currentCategory = category;
            currentQuiz = [...questions[category]].sort(() => Math.random() - 0.5).slice(0, 15);
            currentQuestion = 0;
            score = 0;
            showScreen('quizScreen');
            updateScoreDisplay();
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestion >= currentQuiz.length) {
                endQuiz();
                return;
            }

            const q = currentQuiz[currentQuestion];
            document.getElementById('questionText').textContent = q.q;
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('progressBar').style.width = ((currentQuestion + 1) / currentQuiz.length * 100) + '%';

            const container = document.getElementById('answersContainer');
            container.innerHTML = '';

            q.a.forEach((ans, i) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = ans;
                btn.onclick = () => selectAnswer(i);
                container.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            timeLeft = 30;
            updateTimer();
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 5 && timeLeft > 0) sounds.tick.play().catch(() => {});
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    selectAnswer(-1); // —Ç–∞–π–º–µ—Ä –∏—Å—Ç—ë–∫
                }
            }, 1000);
        }

        function updateTimer() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = timeLeft;
            timerEl.className = timeLeft <= 10 ? 'timer warning' : 'timer';

            const circumference = 339.3;
            const offset = circumference - (timeLeft / 30) * circumference;
            document.querySelector('.timer-progress').style.strokeDashoffset = offset;
        }

        function selectAnswer(selectedIdx) {
            clearInterval(timerInterval);
            const correctIdx = currentQuiz[currentQuestion].c;
            const buttons = document.querySelectorAll('.answer-btn');

            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === correctIdx) btn.classList.add('correct');
                if (i === selectedIdx && selectedIdx !== correctIdx) btn.classList.add('wrong');
            });

            if (selectedIdx === correctIdx) {
                score++;
                updateScoreDisplay();
                sounds.correct.play().catch(() => {});
                createParticles(categoryParticles[currentCategory], 15);
            } else {
                sounds.wrong.play().catch(() => {});
                createParticles('üí´', 8);
            }

            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 1800);
        }

        function updateScoreDisplay() {
            document.getElementById('currentScore').textContent = `${score} / 15`;
        }

        const categoryParticles = {
            science: '‚öõÔ∏è',
            history: 'üï∞Ô∏è',
            culture: 'üé≠',
            chaos: 'üåÄ'
        };

        function createParticles(emoji, count = 12) {
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.textContent = emoji;
                p.style.left = Math.random() * 100 + 'vw';
                p.style.animationDuration = (Math.random() * 1 + 1.5) + 's';
                p.style.fontSize = (Math.random() * 20 + 25) + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 3000);
            }
        }

        function endQuiz() {
            clearInterval(timerInterval);
            sounds.win.play().catch(() => {});

            const percentage = Math.round((score / currentQuiz.length) * 100);
            let achievement = '', message = '';

            if (percentage === 100) { achievement = 'üåå'; message = '–¢—ã —Å—Ç–∞–ª —á–∞—Å—Ç—å—é –∫–æ—Å–º–æ—Å–∞'; }
            else if (percentage >= 90) { achievement = '‚ú®'; message = '–¢—ã –ø–æ—á—Ç–∏ –¥–æ—Å—Ç–∏–≥ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏—è'; }
            else if (percentage >= 75) { achievement = 'üí´'; message = '–¢—ã –Ω–∞ –ø—É—Ç–∏ –∫ –∏—Å—Ç–∏–Ω–µ'; }
            else if (percentage >= 50) { achievement = 'üéØ'; message = '–ù–µ–ø–ª–æ—Ö–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ'; }
            else { achievement = 'üåÄ'; message = '–•–∞–æ—Å ‚Äî —Ç–æ–∂–µ —É—á–∏—Ç–µ–ª—å'; }

            document.getElementById('achievement').textContent = achievement;
            document.getElementById('finalScore').textContent = `${score}/15`;
            document.getElementById('messageText').textContent = `${message}\n–¢–æ—á–Ω–æ—Å—Ç—å: ${percentage}%`;

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥
            const userName = document.getElementById('userName').textContent;
            leaderboardData.push({
                userId, name: userName, score, total: 15, percentage,
                category: currentCategory, date: new Date().toLocaleDateString()
            });

            leaderboardData.sort((a, b) => b.percentage - a.percentage || b.score - a.score);
            leaderboardData = leaderboardData.slice(0, 100);
            localStorage.setItem('cosmic_leaderboard', JSON.stringify(leaderboardData));

            updateTopScores();
            showScreen('resultsScreen');
            createParticles(achievement, 30);
        }

        function updateTopScores() {
            const container = document.getElementById('topScores');
            const top = leaderboardData.slice(0, 3);
            if (!top.length) {
                container.innerHTML = '<p style="text-align:center; opacity:0.7;">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>';
                return;
            }
            container.innerHTML = top.map((e, i) => `
                <div class="leaderboard-item" style="display:flex; justify-content:space-between; padding:12px; background:rgba(255,255,255,0.1); border-radius:15px; margin-bottom:8px;">
                    <span style="font-weight:bold;">#${i+1}</span>
                    <div style="flex:1; margin:0 15px;">
                        <div>${e.name}</div>
                        <div style="font-size:0.9em; opacity:0.8;">${e.category}</div>
                    </div>
                    <span style="font-weight:bold;">${e.percentage}%</span>
                </div>
            `).join('');
        }

        function showLeaderboard() {
            const container = document.getElementById('leaderboardContainer');
            container.innerHTML = '';

            if (!leaderboardData.length) {
                container.innerHTML = '<p style="text-align:center; opacity:0.7; padding:20px;">–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</p>';
                showScreen('leaderboardScreen');
                return;
            }

            // –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userBest = leaderboardData
                .filter(e => e.userId === userId)
                .sort((a,b) => b.percentage - a.percentage)[0];

            if (userBest) {
                container.innerHTML += `
                    <div style="background:linear-gradient(135deg,var(--primary),var(--secondary)); padding:15px; border-radius:18px; margin-bottom:20px; color:white; text-align:center;">
                        <div style="font-size:1.1em;">–¢–≤–æ–π –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                        <div style="font-size:2em; font-weight:bold; margin:10px 0;">${userBest.percentage}%</div>
                        <div>${userBest.category} ‚Ä¢ ${userBest.score}/15</div>
                    </div>`;
            }

            leaderboardData.slice(0, 20).forEach((e, i) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.style.cssText = 'display:flex; justify-content:space-between; padding:15px; background:rgba(255,255,255,0.1); border-radius:15px; margin-bottom:10px;';
                item.innerHTML = `
                    <span style="font-weight:bold; min-width:40px;">#${i+1}</span>
                    <div style="flex:1; margin:0 15px;">
                        <div style="font-weight:bold;">${e.name}</div>
                        <div style="font-size:0.9em; opacity:0.8;">${e.category} ‚Ä¢ ${e.date}</div>
                    </div>
                    <span style="font-weight:bold;">${e.percentage}%</span>
                `;
                container.appendChild(item);
            });

            showScreen('leaderboardScreen');
        }

        function playAgain() {
            startQuiz(currentCategory);
        }

        function shareResult() {
            const percentage = Math.round((score / 15) * 100);
            const text = `‚ú® Cosmic Quiz\n–Ø –ø—Ä–æ—à—ë–ª "${currentCategory}" –Ω–∞ ${score}/15 (${percentage}%)!\n–ü–æ–ø—Ä–æ–±—É–π –ø–æ–±–∏—Ç—å –º–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üöÄ`;
            tg.sendData(JSON.stringify({action: 'share', text}));
            tg.showAlert("–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!\n–ú–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é:\n\n" + text);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const icon = document.getElementById('themeIcon');
            icon.className = document.body.classList.contains('dark-theme') ? 'fas fa-sun' : 'fas fa-moon';
            createParticles(document.body.classList.contains('dark-theme') ? 'üåô' : '‚òÄÔ∏è', 10);
        }

        function backToMenu() {
            showScreen('menuScreen');
        }

        document.addEventListener('DOMContentLoaded', () => {
            createStars();
            initTelegramUser();
            updateTopScores();

            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('button').forEach(b => {
                b.addEventListener('touchstart', () => b.style.transform = 'scale(0.95)');
                b.addEventListener('touchend', () => b.style.transform = '');
                b.addEventListener('mousedown', () => b.style.transform = 'scale(0.95)');
                b.addEventListener('mouseup', () => b.style.transform = '');
            });
        });
    </script>
</body>
</html>
